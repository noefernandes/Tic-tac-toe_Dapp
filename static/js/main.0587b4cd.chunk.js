(this["webpackJsonptic-tac-toe_dapp"]=this["webpackJsonptic-tac-toe_dapp"]||[]).push([[0],{250:function(t,e,n){},264:function(t,e){},268:function(t,e){},270:function(t,e){},274:function(t,e){},300:function(t,e){},302:function(t,e){},316:function(t,e){},318:function(t,e){},348:function(t,e){},350:function(t,e){},440:function(t,e){},441:function(t,e){},465:function(t,e){},472:function(t,e){},526:function(t,e){},553:function(t,e,n){"use strict";n.r(e);var a=n(243),r=n(101),s=n(10),i=n(4),o=n(5),u=n(7),c=n(6),l=n(3),h=n.n(l),d=n(81),p=n.n(d),m=n(239),b=n.n(m),f=(n(250),n(240)),y=n.n(f),g=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,internalType:"string",name:"nome",type:"string"},{indexed:!1,internalType:"address",name:"end",type:"address"},{indexed:!1,internalType:"bool",name:"status",type:"bool"}],name:"Pagamento",type:"event"},{inputs:[],name:"destroy",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"string",name:"_nomeJogador",type:"string"},{internalType:"uint256",name:"pos",type:"uint256"}],name:"fazerJogada",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"mostrarPremioTotal",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"mostrarTabuleiro",outputs:[{internalType:"uint256[9]",name:"",type:"uint256[9]"}],stateMutability:"view",type:"function"},{inputs:[],name:"mostrarUltimoJogador",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"string",name:"_nomeJogador",type:"string"}],name:"pagarJogo",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"string",name:"_nomeJogador",type:"string"}],name:"pagarOVencedor",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"payable",type:"function"},{inputs:[],name:"verificarVitoria",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"verifyPagamento",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"}],v=n(18),j=n(552).utils;function O(t){return Object(v.jsx)("button",{className:"square",onClick:t.onClick,children:t.value})}var x=function(t){Object(u.a)(n,t);var e=Object(c.a)(n);function n(){return Object(i.a)(this,n),e.apply(this,arguments)}return Object(o.a)(n,[{key:"renderSquare",value:function(t){var e=this;return Object(v.jsx)(O,{value:this.props.squares[t],onClick:function(){return e.props.onClick(t)}})}},{key:"render",value:function(){return Object(v.jsxs)("div",{children:[Object(v.jsxs)("div",{className:"board-row",children:[this.renderSquare(0),this.renderSquare(1),this.renderSquare(2)]}),Object(v.jsxs)("div",{className:"board-row",children:[this.renderSquare(3),this.renderSquare(4),this.renderSquare(5)]}),Object(v.jsxs)("div",{className:"board-row",children:[this.renderSquare(6),this.renderSquare(7),this.renderSquare(8)]})]})}}]),n}(p.a.Component),S=function(t){Object(u.a)(n,t);var e=Object(c.a)(n);function n(t){var a;return Object(i.a)(this,n),(a=e.call(this,t)).sleep=function(t){return new Promise((function(e){return setTimeout(e,t)}))},a.state={squares:Array(9).fill(null),web3:null,account:null,contracts:{},username:"",lastPlayer:"",bet:"",totalBet:"",gameState:"",disabled:!0},a.handleSubmit=a.handleSubmit.bind(Object(s.a)(a)),a.payWinner=a.payWinner.bind(Object(s.a)(a)),a}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.init(),this.lookupInterval=setInterval((function(){t.mostrarTabuleiro(),t.verificarVitoria(),t.atualizarQuadro()}),500)}},{key:"componentWillUnmount",value:function(){clearInterval(this.lookupInterval)}},{key:"init",value:function(){var t=Object(r.a)(h.a.mark((function t(){var e,n=this;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("undefined"===typeof window.ethereum){t.next=16;break}return t.prev=1,t.next=4,window.ethereum.request({method:"eth_requestAccounts"});case 4:e=t.sent,this.setState({account:e[0]}),window.ethereum.on("accountsChanged",(function(){n.setState({account:n.state.web3.eth.getAccounts()[0]}),window.location.reload(!1)})),t.next=13;break;case 9:return t.prev=9,t.t0=t.catch(1),console.error("Usu\xe1rio negou acesso ao web3!"),t.abrupt("return");case 13:this.setState({web3:new y.a(window.ethereum)}),t.next=18;break;case 16:return console.error("Instalar MetaMask!"),t.abrupt("return");case 18:this.initContract(),this.state.contracts.Jogo.getPastEvents("Pagamento",{fromBlock:0,toBlock:"latest"}).then((function(t){var e="",a=j.getAddress(n.state.web3.currentProvider.selectedAddress);t.length>1&&(t[t.length-2].returnValues.end===a?e=t[t.length-2].returnValues.nome:t[t.length-1].returnValues.end===a&&(e=t[t.length-1].returnValues.nome)),n.setState({username:e.toString(),usernameDisplay:e.toString()})})),this.mostrarTabuleiro();case 21:case"end":return t.stop()}}),t,this,[[1,9]])})));return function(){return t.apply(this,arguments)}}()},{key:"initContract",value:function(){var t=Object(r.a)(h.a.mark((function t(){var e;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(e=Object(a.a)({},this.state.contracts)).Jogo=new this.state.web3.eth.Contract(g,"0x142e307Ddcf94AB4DCd28c01cD7D8258f9Fa72aB"),this.setState({contracts:e});case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"mostrarTabuleiro",value:function(){var t=this;this.state.contracts.Jogo.methods.mostrarTabuleiro().call().then((function(e){for(var n=[9],a=0;a<9;a++)"0"===e[a]?n[a]=" ":"1"===e[a]?n[a]="X":"2"===e[a]?n[a]="O":n[a]="e";t.setState({squares:n})}))}},{key:"verificarVitoria",value:function(){var t=this;this.state.contracts.Jogo.methods.verificarVitoria().call().then((function(e){e===t.state.username?t.setState({gameState:e,disabled:!1}):t.setState({gameState:e})}))}},{key:"atualizarQuadro",value:function(){var t=this;this.state.contracts.Jogo.methods.mostrarPremioTotal().call().then((function(e){t.setState({totalBet:e})})),this.state.contracts.Jogo.methods.mostrarUltimoJogador().call().then((function(e){t.setState({lastPlayer:e})}))}},{key:"handleClick",value:function(){var t=Object(r.a)(h.a.mark((function t(e){var n=this;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.state.contracts.Jogo.methods.verifyPagamento().call().then((function(t){t&&n.state.contracts.Jogo.methods.fazerJogada(n.state.username,e).send({from:n.state.account}).then((function(t){n.state.contracts.Jogo.methods.mostrarTabuleiro().call().then((function(t){}))}))})),this.mostrarTabuleiro();case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"handleSubmit",value:function(t){t.preventDefault();var e=1e17*parseInt(this.state.bet);this.state.contracts.Jogo.methods.pagarJogo(this.state.username).send({from:this.state.account,value:e}).then((function(t){}))}},{key:"payWinner",value:function(t){var e=this;t.preventDefault(),this.state.contracts.Jogo.methods.verificarVitoria().call().then((function(t){t===e.state.username?e.setState({gameState:t,disabled:!1}):e.setState({gameState:t})})),this.state.username===this.state.gameState&&this.state.contracts.Jogo.methods.pagarOVencedor(this.state.gameState).send({from:this.state.account}).then((function(t){}))}},{key:"render",value:function(){var t=this;return Object(v.jsxs)("div",{children:[Object(v.jsx)("div",{className:"header",children:"Jogo da Velha"}),Object(v.jsxs)("div",{className:"game",children:[Object(v.jsx)("div",{className:"game-board",children:Object(v.jsx)(x,{squares:this.state.squares,onClick:function(e){return t.handleClick(e)}})}),Object(v.jsxs)("div",{className:"game-info",children:[Object(v.jsxs)("form",{onSubmit:this.handleSubmit,children:[Object(v.jsx)("label",{children:Object(v.jsx)("strong",{children:"Nome:"})}),Object(v.jsx)("input",{type:"text",onChange:function(e){t.setState({username:e.target.value})}}),Object(v.jsx)("label",{children:Object(v.jsx)("strong",{children:"Valor de aposta:"})}),Object(v.jsx)("input",{type:"text",onChange:function(e){t.setState({bet:e.target.value})}}),Object(v.jsx)("button",{type:"submit",className:"button",children:"Inscrever usu\xe1rio"})]}),Object(v.jsxs)("form",{onSubmit:this.payWinner,children:[Object(v.jsxs)("h2",{children:["Jogador: ",this.state.username]}),Object(v.jsxs)("h2",{children:["Ultimo a jogar: ",this.state.lastPlayer]}),Object(v.jsxs)("h2",{children:["Pr\xeamio total: ",this.state.totalBet/1e18," ether"]}),Object(v.jsxs)("h2",{children:["Resultado: ",this.state.gameState," "]}),Object(v.jsx)("button",{type:"submit",disabled:this.state.disabled,style:{backgroundColor:this.state.disabled?"#CCC":"#4CAF50"},className:"button",children:"Resgatar pr\xeamio"})]})]})]})]})}}]),n}(p.a.Component);b.a.render(Object(v.jsx)(S,{}),document.getElementById("root"))}},[[553,1,2]]]);
//# sourceMappingURL=main.0587b4cd.chunk.js.map